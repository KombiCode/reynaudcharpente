<div class="shadow-xl rounded-xl">
  <div class="flex flex-col items-baseline p-4 space-y-6 rounded shadow-lg font-jost">
    <div class="flex items-center justify-between w-full pb-2 text-gray-700 border-b border-gray-200">
      <div class="flex items-center whitespace-nowrap">
        <% if opinion.rating_average < 5.1 %>
          <%= image_tag "smiley-negative.svg", alt: "Reynaud Charpente, spécialiste maison ossature bois", width: "40", height: "40", class: "content-center mr-2" %>
        <% elsif opinion.rating_average < 7.5 %>
          <%= image_tag "smiley-neutral.svg", alt: "Reynaud Charpente, spécialiste maison ossature bois", width: "40", height: "40", class: "content-center mr-2" %>
        <% else %>
          <%= image_tag "smiley-positive.svg", alt: "Reynaud Charpente, spécialiste maison ossature bois", width: "40", height: "40", class: "content-center mr-2" %>
        <% end %>
        <% (opinion.rating_average.round(0)/2).times do %> 
          <span class="block">
            <i class="text-yellow-300 shadow-custom fas fa-star"></i>
          </span>
        <% end %>
        <% (opinion.rating_average.round(0)%2).times do %>
          <span class="block">
            <i class="text-yellow-300 shadow-custom fas fa-star-half"></i>
          </span>
        <% end %>
        <% ((10 - opinion.rating_average.round(0))/2).times do %>
          <span class="block">
            <i class="text-gray-500 shadow-custom fas fa-star"></i>
          </span>
        <% end %>
        <span class="ml-2">
          <strong><%= opinion.rating_average.round(1) %></strong>
          <small>/10</small>
        </span>
        <% if !opinion.control.empty? %>
          <div class="flex items-center ml-8">
            <i class="fa-solid fa-certificate"></i>
            <div class="ml-1 text-sm font-semibold"><%= opinion.control %></div>
          </div>
        <% end %>
      </div>
      <div class="cursor-pointer" data-accordion-target="title" data-action="click->accordion#change">
        <svg viewBox="0 0 20 20" width="20" height="20" class="fill-current text-grey-dark accordion-arrow">
          <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"></path>
        </svg>
      </div>
    </div>
    <div class="hidden w-full accordion-content" data-accordion-target="body">
      <div class="block">
        <% opinion.ratings.each do |rating| %>
          <div class="flex justify-between px-5">
            <div class="block">
              <%= Category.find(rating.category_id).name %>
            </div>
            <div class="flex whitespace-nowrap">
              <% (rating.note.round(0)/2).times do %> 
                <span class="block">
                  <i class="text-yellow-300 shadow-custom fas fa-star"></i>
                </span>
              <% end %>
              <% (rating.note.round(0)%2).times do %>
                <span class="block">
                  <i class="text-yellow-300 shadow-custom fas fa-star-half"></i>
                </span>
              <% end %>
              <% ((10 - rating.note.round(0))/2).times do %>
                <span class="block">
                  <i class="text-gray-500 shadow-custom fas fa-star"></i>
                </span>
              <% end %>
              <span class="ml-2">
                <strong><%= rating.note.round(0) %></strong>
                <small>/10</small>
              </span>
            </div>
          </div>
        <% end %>
      </div>
    </div>
    <h2 class="text-xl font-bold truncate text-brandActive"><%= opinion.title %></h2>
    <p class="text-base text-gray-600"><%= opinion.description %></p>
    <p class="text-base font-semibold text-gray-500">Détails de la prestation :</p>
    <p class="text-base text-gray-700"><%= opinion.details %></p>
    <div class="flex justify-between w-full text-gray-700 border-t border-gray-200">
      <div class="flex justify-between w-full px-5 py-2">
        <div class="block">
          <div class="flex items-center">
            <i class="fa-solid fa-calendar-day"></i>
            <div class="ml-2 font-bold">Prestation</div>
          </div>
          <div class="text-sm"><%= opinion.realized_at.strftime("%m/%Y") %></div>
        </div>
        <div class="block">
          <div class="flex items-center">
            <i class="fa-solid fa-comment"></i>
            <div class="ml-2 font-bold">Dépôt</div>
          </div>
          <div class="text-sm"><%= opinion.filed_at.strftime("%d/%m/%Y") %></div>
        </div>
        <div class="block">
          <div class="flex items-center">
          <i class="fa-solid fa-check"></i>
          <div class="ml-2 font-bold">Publication</div>
          </div>
          <div class="text-sm"><%= opinion.published_at.strftime("%d/%m/%Y") %></div>
        </div>
        <div class="block">
          <div class="flex items-center">
          <i class="fa-solid fa-user"></i>
          <div class="ml-2 font-bold">Référence</div>
          </div>
          <div class="text-sm"><%= opinion.reference %></div>
        </div>
    </div>
  </div>
</div>


